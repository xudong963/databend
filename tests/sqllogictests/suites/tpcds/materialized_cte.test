statement ok
set sandbox_tenant = 'test_tenant';

statement ok
use tpcds;
# Q1
onlyif mysql
query I
WITH customer_total_return AS materialized
  (SELECT sr_customer_sk AS ctr_customer_sk,
          sr_store_sk AS ctr_store_sk,
          sum(sr_return_amt) AS ctr_total_return
   FROM store_returns,
        date_dim
   WHERE sr_returned_date_sk = d_date_sk
     AND d_year = 2000
   GROUP BY sr_customer_sk,
            sr_store_sk)
SELECT c_customer_id
FROM customer_total_return ctr1,
     store,
     customer
WHERE ctr1.ctr_total_return >
    (SELECT avg(ctr_total_return)*1.2
     FROM customer_total_return ctr2
     WHERE ctr1.ctr_store_sk = ctr2.ctr_store_sk)
  AND s_store_sk = ctr1.ctr_store_sk
  AND s_state = 'TN'
  AND ctr1.ctr_customer_sk = c_customer_sk
ORDER BY c_customer_id
LIMIT 100;
----
AAAAAAAAAACAAAAA
AAAAAAAAAGBAAAAA
AAAAAAAAAHCAAAAA
AAAAAAAAAICAAAAA
AAAAAAAAAKCAAAAA
AAAAAAAAAKDAAAAA
AAAAAAAAALBAAAAA
AAAAAAAAANBAAAAA
AAAAAAAAAPCAAAAA
AAAAAAAABEAAAAAA
AAAAAAAABGBAAAAA
AAAAAAAABGDAAAAA
AAAAAAAABMBAAAAA
AAAAAAAABMDAAAAA
AAAAAAAABNCAAAAA
AAAAAAAACDDAAAAA
AAAAAAAACEBAAAAA
AAAAAAAACECAAAAA
AAAAAAAACFDAAAAA
AAAAAAAACGBAAAAA
AAAAAAAACHBAAAAA
AAAAAAAACNDAAAAA
AAAAAAAADEBAAAAA
AAAAAAAADEDAAAAA
AAAAAAAADFAAAAAA
AAAAAAAADFCAAAAA
AAAAAAAADIBAAAAA
AAAAAAAADNAAAAAA
AAAAAAAADOCAAAAA
AAAAAAAAEBAAAAAA
AAAAAAAAEBBAAAAA
AAAAAAAAECBAAAAA
AAAAAAAAEKAAAAAA
AAAAAAAAEPBAAAAA
AAAAAAAAFCAAAAAA
AAAAAAAAFJAAAAAA
AAAAAAAAFJCAAAAA
AAAAAAAAFMCAAAAA
AAAAAAAAFPBAAAAA
AAAAAAAAGAAAAAAA
AAAAAAAAGBBAAAAA
AAAAAAAAGOBAAAAA
AAAAAAAAHEBAAAAA
AAAAAAAAHHDAAAAA
AAAAAAAAHICAAAAA
AAAAAAAAHLDAAAAA
AAAAAAAAHNCAAAAA
AAAAAAAAICAAAAAA
AAAAAAAAIFDAAAAA
AAAAAAAAIIAAAAAA
AAAAAAAAIMAAAAAA
AAAAAAAAINAAAAAA
AAAAAAAAIOAAAAAA
AAAAAAAAIODAAAAA
AAAAAAAAJCCAAAAA
AAAAAAAAJFBAAAAA
AAAAAAAAJFCAAAAA
AAAAAAAAJKAAAAAA
AAAAAAAAJMDAAAAA
AAAAAAAAKADAAAAA
AAAAAAAAKBAAAAAA
AAAAAAAAKCDAAAAA
AAAAAAAAKECAAAAA
AAAAAAAAKGDAAAAA
AAAAAAAAKHBAAAAA
AAAAAAAAKJAAAAAA
AAAAAAAAKJCAAAAA
AAAAAAAAKJDAAAAA
AAAAAAAAKNAAAAAA
AAAAAAAALABAAAAA
AAAAAAAALBCAAAAA
AAAAAAAALCAAAAAA
AAAAAAAALCDAAAAA
AAAAAAAALFAAAAAA
AAAAAAAALFCAAAAA
AAAAAAAALLCAAAAA
AAAAAAAALNBAAAAA
AAAAAAAAMAAAAAAA
AAAAAAAAMABAAAAA
AAAAAAAAMACAAAAA
AAAAAAAAMBBAAAAA
AAAAAAAAMBCAAAAA
AAAAAAAAMGCAAAAA
AAAAAAAAMHCAAAAA
AAAAAAAAMJAAAAAA
AAAAAAAAMJDAAAAA
AAAAAAAANBCAAAAA
AAAAAAAANBDAAAAA
AAAAAAAANCAAAAAA
AAAAAAAANDCAAAAA
AAAAAAAANLAAAAAA
AAAAAAAANLBAAAAA
AAAAAAAANMAAAAAA
AAAAAAAANMBAAAAA
AAAAAAAAODCAAAAA
AAAAAAAAOIAAAAAA
AAAAAAAAOIDAAAAA
AAAAAAAAONBAAAAA
AAAAAAAAONCAAAAA
AAAAAAAAOOAAAAAA
